# 设计阶段 (Design Phase)

> 在动手实现之前，明确技术方案、权衡取舍、关键决策。

## 触发条件

当任务涉及以下内容时，需要技术设计：

- ✅ 跨模块/跨服务变更
- ✅ 新增外部依赖
- ✅ 数据模型变更
- ✅ 有安全/性能考虑
- ✅ 架构模式选择
- ✅ 多种实现方案需要权衡

以下情况可跳过设计：

- ❌ 单模块内的简单变更
- ❌ 方案唯一且明确
- ❌ Bug 修复

## 输入

- 提案文档（来自提案阶段）
- 相关技术上下文

## 执行步骤

### 1. 加载上下文

```
加载内容：
- context/tech/architecture.md
- context/tech/conventions/[相关规范]
- context/experience/INDEX.md（检索相关经验）
```

### 2. 创建设计文档

设计文档应包含：

```markdown
# 设计：[功能名称]

## 背景
[简要说明问题和目标，可引用提案]

## 目标 / 非目标
- 目标：[...]
- 非目标：[...]

## 方案

### 方案概述
[整体方案描述]

### 关键决策
| 决策 | 选择 | 理由 |
|------|------|------|
| [决策1] | [选择] | [理由] |
| [决策2] | [选择] | [理由] |

### 替代方案
[考虑过但未选择的方案及原因]

## 详细设计

### [模块1]
[模块1的设计细节]

### [模块2]
[模块2的设计细节]

## 风险与缓解
| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| [风险1] | [影响] | [措施] |

## 开放问题
- [ ] [待确认问题1]
- [ ] [待确认问题2]
```

### 3. 审核设计

设计需要回答：

- [ ] 方案满足需求吗？
- [ ] 关键决策有充分理由吗？
- [ ] 风险可控吗？
- [ ] 与现有架构一致吗？
- [ ] 开放问题都解决了吗？

## 输出

- 设计文档（design.md 或等效文档）
- 更新后的任务清单（如有调整）

## 下一阶段

设计审核通过后，进入 [实现阶段](implement.md)。

## 验证标准

- [ ] 设计文档完整
- [ ] 关键决策明确
- [ ] 风险已评估
- [ ] 开放问题已解决
- [ ] 符合项目架构规范
